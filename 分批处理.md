```php

$i = 1;         // 从第一页开始
$per = 1000;    // 每次处理条数
$sleep = 10;    // 休息时间
while(true) {

    $list = $users_business->getWechatYanUser([
        'page'      => $i,
        'page_size' => $per,
    ]);

    if (empty($list)) {
        break;
    }

    $message = [];
    foreach($list as $user) {
        $sub_show_url = $need_replace ? str_replace('*', $user['project'], $show_url) : $show_url;

        $message[] = [
            'msg_id'   => $msg_id . ':' . $user['openid'],
            'show_url' => $sub_show_url,
            'project'  => $this->extra['project'],
            'touser'   => $user['openid'],
            'remark'   => isset($this->extra['remark']) ? $this->extra['remark'] : '',
            'name'     => isset($this->extra['name']) ? $this->extra['name'] : '',
            'datetime' => date('Y-m-d H:i:s'),
        ];
    }

    // 执行业务

    // 还有下一批 休息几秒
    if ((count($list) == $per) && $sleep) {
        sleep($sleep);
    }

    $i++;
}
```
